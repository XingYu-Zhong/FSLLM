# TrendAnalyzer 趋势分析工具

`TrendAnalyzer` 是一个用于分析金融市场价格趋势的工具类，主要基于 ZigZag 算法实现趋势识别和分析。

## 主要功能

该工具类提供以下核心功能：
1. ZigZag 枢纽点识别
2. 趋势判断
3. 自适应参数的股票趋势分析

## 使用方法

### 1. 基础使用

```python
import pandas as pd
from trend_analysis import TrendAnalyzer

# 准备数据
df = pd.DataFrame({
    'close': [100, 102, 101, 103, 102, 105, 103, 106]
})

# 分析趋势
trend, pivots = TrendAnalyzer.analyze_stock_trend(df, price_col='close')
print(f"当前趋势: {trend}")
```

### 2. 自定义参数分析

```python
# 使用自定义参数的ZigZag分析
pivots = TrendAnalyzer.zigzag_pivots(df, price_col='close', pct_threshold=2.0)

# 自定义参数的趋势判断
trend = TrendAnalyzer.judge_trend(pivots, tolerance=0.5)
```

## 核心原理

### ZigZag算法原理

ZigZag算法通过以下步骤识别市场中的关键转折点：

1. **价格反转确认**：
   - 当价格从前一个低点上涨超过设定的百分比阈值时，确认一个高点
   - 当价格从前一个高点下跌超过设定的百分比阈值时，确认一个低点

2. **动态更新**：
   - 在确认新的转折点之前，如果出现更高的高点或更低的低点，会动态更新当前的极值点

### 趋势判断原理

趋势判断基于以下规则：

1. **上升趋势**：
   - 最近两个高点呈上升趋势（后高点 >= 前高点 - 容忍度）
   - 最近两个低点呈上升趋势（后低点 > 前低点 + 容忍度）

2. **下降趋势**：
   - 最近两个高点呈下降趋势（前高点 > 后高点 + 容忍度）
   - 最近两个低点呈下降趋势（前低点 > 后低点 + 容忍度）

3. **横盘趋势**：
   - 不满足上升或下降趋势的条件
   - 数据点不足以判断趋势（少于4个枢纽点）

### 自适应参数机制

该工具具有智能的参数自适应机制：

1. **百分比阈值(pct_threshold)自适应**：
   - 基于日均波动率自动计算
   - 取值范围限制在1%~5%之间
   - 默认为日均波动率的2倍

2. **容忍度(tolerance)自适应**：
   - 基于价格区间范围计算
   - 默认为价格区间的2%
   - 确保在不同价格区间都有合适的容忍度

## 注意事项

1. 输入数据需要包含必要的价格列（默认为'close'）
2. 数据量建议至少大于4个交易周期，以确保趋势判断的准确性
3. 在极端市场条件下，可能需要手动调整参数以获得更好的效果 